<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="CSS/body.css">
  <link rel="stylesheet" href="CSS/body_header_left.css">
  <link rel="stylesheet" href="CSS/body_header_right.css">
  <link rel="stylesheet" href="CSS/body_warning.css">

  <title>configuracion</title>
  <style>
    :root {
      --color-B: white;
      --color-1: #0cc2f9;
      --color-2: rgb(35, 107, 175);
    }

    .div-pastel {
      width: 90px;
      height: 90px;
      margin: 5px;
      display: inline-block;
      border-radius: 5px;
      transition: background-color 0.3s ease-in-out;
      cursor: pointer;
    }

    .div-pastel:hover {
      box-shadow: inset 0 0 0 4px red;
    }

    /* Colores pasteles */
    .div-pastel:nth-child(1) {
      background-color: #d4b8e6;
    }

    .div-pastel:nth-child(2) {
      background-color: #f5c7c7;
    }

    .div-pastel:nth-child(3) {
      background-color: #ffe6b8;
    }

    .div-pastel:nth-child(4) {
      background-color: #c1e1c1;
    }

    .div-pastel:nth-child(5) {
      background-color: #d2d1e3;
    }

    .div-pastel:nth-child(6) {
      background-color: #e8c4c9;
    }

    .div-pastel:nth-child(7) {
      background-color: #f9dfb3;
    }

    .div-pastel:nth-child(8) {
      background-color: #b3d9d9;
    }

    .div-pastel:nth-child(9) {
      background-color: #e3e1d9;
    }

    .div-pastel:nth-child(10) {
      background-color: #e6c5d5;
    }

    .div-pastel:nth-child(11) {
      background-color: #c9e5c9;
    }

    .div-pastel:nth-child(12) {
      background-color: #d9d7eb;
    }

    .div-pastel:nth-child(13) {
      background-color: #f6c2c2;
    }

    .div-pastel:nth-child(14) {
      background-color: #ffe0a9;
    }

    .div-pastel:nth-child(15) {
      background-color: #a2c8a2;
    }

    .div-pastel:nth-child(16) {
      background-color: #e7e6f2;
    }

    .div-pastel:nth-child(17) {
      background-color: #ef9d9d;
    }

    .div-pastel:nth-child(18) {
      background-color: #fcdb90;
    }

    .div-pastel:nth-child(19) {
      background-color: #9bd6d6;
    }

    .div-pastel:nth-child(20) {
      background-color: #dbdad2;
    }

    .div-pastel:hover {
      filter: brightness(80%);
    }




    img {
      width: 40px;
      height: 40px;
      border-radius: 40px;
    }

    #configuracion {
      background-color: var(--color-B);
      margin: 40px;
      margin-top: 60px;
      margin-bottom: 60px;
      padding: 40px;
      padding-bottom: 50px;
      border-radius: 40px;
      box-shadow: 20px 10px 40px rgba(0, 0, 0, 0.5);
      display: flex;
      gap: 60px;
    }

    #contenedorUsuariosCategoriaSubcategoria {
      display: flex;
      flex-direction: column;
      gap: 20px;

    }

    #configuracion label {
      line-height: 20px;
      padding-left: 20px;
    }

    .laberDiv {
      display: flex;
      flex-direction: column;
    }

    .usuarioCategoriaSubcategoria {
      /* background-color: violet; */

      width: 350px;
      padding: 10px;
      border: 3px solid gray;
      border-radius: 20px;

    }




    #usuario {
      display: flex;
      justify-content: left;
      align-items: center;
      gap: 10px;
    }

    #usuarioImg {
      cursor: pointer;
    }

    #usuarioImg:hover {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 0, 0, 0.3), 0 0 30px rgba(0, 0, 0, 0.2), 0 0 40px rgba(0, 0, 0, 0.1);
    }

    #usuario input {
      width: 300px;
      height: 30px;
      background-color: transparent;
      border: 0;
      border-bottom: 2px dashed gray;
    }

    #categoria {
      display: flex;
      flex-direction: column;
      height: 300px;
      gap: 10px;
      overflow-y: scroll;
      scrollbar-width: thin;
      scrollbar-color: var(--color-1) var(--color-2);
    }




    .contendorCategoria {
      display: flex;
      align-items: center;


    }

    .contendorCategoria:hover {
      background-color: rgb(255, 183, 183);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 0, 0, 0.3), 0 0 30px rgba(0, 0, 0, 0.2), 0 0 40px rgba(0, 0, 0, 0.1);
    }


    .contendorCategoria input {
      padding: 5px;

      background-color: transparent;
      border: 0;
      width: 195px;
      font-size: 14px;
    }

    #subcategoria {
      display: flex;
      flex-direction: column;
      height: 300px;
      gap: 10px;
      overflow-y: scroll;
      scrollbar-width: thin;
      scrollbar-color: var(--color-1) var(--color-2);


    }

    .icono {
      border-radius: 10px;
      cursor: pointer;
    }

    .icono:hover {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 0, 0, 0.3), 0 0 30px rgba(0, 0, 0, 0.2), 0 0 40px rgba(0, 0, 0, 0.1);
    }

    .contenedorBasuraGota {

      border-right: 2px dashed black;
      border-top: 2px dashed black;
      border-bottom: 2px dashed black;
      display: flex;
      /* flex-direction: column; */
      border-radius: 0 10px 10px 0;

      align-items: center;
      gap: 2px;
      padding: 5px;

    }

    .contenedorIconoText {
      display: flex;

      border-radius: 20px 0 0 20px;
      align-items: center;
      gap: 12px;
      /* paddi ng: 12px; */
      margin-left: 6px;
    }

    .gota {
      border: 0;
      border-radius: 80px;
      background-color: transparent;

    }

    .gotaImg {
      background-color: var(--color-1);
      cursor: pointer;
      height: 20px;
      width: 20px;


    }

    .gotaImg:hover {
      background-color: var(--color-2);
    }

    #configuracionContenedor {
      display: flex;
      flex-direction: column;

    }

    .contenedorGeneralConfiguracion {

      top: 400px;
      border: 3px solid gray;
      border-radius: 20px;
      width: 650px;
      height: 375px;
      padding: 10px;
      padding-left: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      overflow-y: scroll;
      scrollbar-width: thin;
      scrollbar-color: var(--color-1) var(--color-2);
    }

    .contenedorImagen {

      cursor: pointer;
      padding: 10px;
      width: 70px;
      height: 70px;
      border-radius: 10px;

    }

    .contenedorImagen img {
      width: 70px;
      height: 70px;

    }

    .contenedorImagen:hover {
      box-shadow: inset 0 0 0 4px red;
    }

    #contenedorR {
      border-radius: 20px;
      width: 650px;
      border: 3px solid gray;
      padding: 10px;
      padding-left: 20px;
      height: 300px;
    }

    #tabla table {
      width: 640px;

    }

    #tabla_tarjeta table {
      width: 640px;


    }

    #tabla th,
    td {
      border-bottom: 1px solid black;
      padding-top: 16px;
      padding-left: 8px;
      padding-right: 8px;
      padding-bottom: 2px;

      text-align: center;
    }

    #tabla_tarjeta input {
      border-top: 0;
      border-left: 0;
      border-right: 0;
      border-color: var(--color-1);

      width: 100%;
    }

    #wrapModificar {
      display: flex;
      flex-wrap: wrap;
      width: 100%;
      height: 10%;
    }


    /* Boton ocultar grupo B */
    #bottonGurpo_relative {
      position: relative;
    }

    #bottonGurpoB {
      position: absolute;
      z-index: 99;
      top: 472px;
      border: none;
      left: 560px;
      height: 20px;
      width: 100px;
      line-height: 0;
      border-radius: 10px 10px 0 0px;
      font-size: 12px;
    }

    #bottonGurpoB:hover {
      background-color: var(--color-2);
    }

    .basuraAdaptacion {
      width: 60px;
    }

    /* Cargar imagen */
    .grupo {
      position: relative;
    }

    .positionAbsoluteA {
      position: absolute;
      top: 200px;
      display: none;
      pointer-events: none;

    }

    .positionAbsoluteB {
      position: absolute;
      top: 670px;

    }

    #masImagen_relative {
      position: relative;
    }

    #masImagen {
      display: flex;
      position: absolute;
      z-index: 99;
      top: 422px;

    }

    .imageM {
      position: absolute;
      left: 600px;
      padding-top: 5px;
      padding-bottom: 5px;
      width: 30px;
      cursor: pointer;
      font-size: 20px;
      border-radius: 0 0 0 10px;
      color: white;
      transition: background-color 0.2s ease;
      background-color: var(--color-1);
    }

    .imageM:hover {
      background-color: var(--color-2);
    }

    .imageM input[type="file"] {
      display: none;
    }

    .imageM input[type="text"] {
      display: none;
    }

    #basura {
      border: none;
      left: 648px;
      height: 30px;
      width: 40px;
      padding: 5px;
      border-radius: 0 0 10px 0px;

    }

    #basura img {
      height: 20px;
      width: 20px;
    }

    .contenedorTexto {

      height: 35px;
      display: flex;
      justify-content: center;
    }

    .imputInvisible {
      display: none; 
    }

    .imputMas {
      width: 60px;
      background-color: var(--color-1);
      cursor: pointer;

    }

    .imputMas:hover {
      background-color: var(--color-2);
    }

    .imputMasText {
      font-size: 40px;
      color: white;
    }

    .ContenedorSubmit {
      border-right: 2px dashed black;
      border-top: 2px dashed black;
      border-bottom: 2px dashed black;
      display: flex;

      border-radius: 0 10px 10px 0;

      align-items: center;

      height: 35px;
      width: 32px;
      background-color: var(--color-1);
      cursor: pointer;
    }

    .ContenedorSubmit:hover {
      background-color: var(--color-2);
    }

    .adpatacionGota {
      border-radius: 0 0 0 0;
    }
  </style>

</head>

<body>
  <header id="Cabecera">
    <nav>
      <ul>
        <li id="cuenta">
          <a href="index.html">
            <img src="Photos/Iconos_aplicacion/Blancos/BCuentas.png" alt="Cuentas">
            Cuenta
          </a>
        </li>
        <li id="ahorro">
          <a href="ahorro.html">
            <img src="Photos/Iconos_aplicacion/Blancos/BAhorro.png" alt="Ahorros">
            Ahorro
          </a>
        </li>
        <li id="resumenes">
          <a href="resumenes.html">
            <img src="Photos/Iconos_aplicacion/Blancos/Resumenes.png" alt="Resumenes">
            Resúmenes
          </a>
        </li>
      </ul>
      <ul id="Cabecera_derecha">
        <li id="Cabecera_derecha_li">
          <a href="configuracion.html">
            <img src="Photos/Iconos_aplicacion/Blancos/BConfiguracion.png" alt="Configuración">
          </a>
        </li>
        <li id="CD_boton">
          <button id="boton_usuarios">
            <img src="Photos/Iconos_aplicacion/Blancos/Usuario.png" alt="Icono de usuario">
            <h2>Usuario</h2>
          </button>
          <div id="boton_usuarios_desliegue">
            <button id="eliminarCuenta">
              Eliminar usuario
            </button>
            <hr>
            <button>
              Cambiar usuario
            </button>
          </div>
        </li>
      </ul>
    </nav>
  </header>

  <main>
    <!-- Sección que contiene un div que muestra una advertencia al usuario al intentar eliminar una cuenta.
    CSS: position: absolute  opacity: 0
    se activa cuando el usuario pulsa el botón 'Eliminar cuenta' en el menú desplegable que se muestra al hacer clic en el botón de usuario. -->
    <section id="eliminar_usuario">
      <article>
        <div id="eliminar_usuario_div_1">
          <h2>Warning</h2>
        </div>
        <div id="eliminar_usuario_div_2">
          <h2>¿Estas seguro de eliminar el usuario actual?</h2>
          <p>Esta acción no se puede deshacer una vez confirmada. Todos los registros relacionados con esta cuenta se
            eliminarán permanentemente.</p>
        </div>
        <div>
          <ul id="eliminar_usuario_div_3">
            <li>
              <button id="eliminar_aceptar">
                Aceptar
              </button>
            </li>
            <li>
              <button id="eliminar_cancelar">
                Cancelar
              </button>
            </li>
          </ul>
        </div>
      </article>
    </section>

    <section id="configuracion">
      <div id="contenedorUsuariosCategoriaSubcategoria">
        <div id="prueba" class="laberDiv">
          <label for="">Configura el usuario</label>
          <div id="usuario" class="usuarioCategoriaSubcategoria">
            <img id="usuarioImg" src="Photos/Icon/Login/Capa 3.png" alt="Usuario">
            <input type="text" value="1">
          </div>
        </div>

        <div class="laberDiv">
          <label for="">Configura la categoría</label>

          <div id="categoria" class="usuarioCategoriaSubcategoria">

            <div class="contendorCategoria">
              <div class="contenedorIconoText">
                <img class="icono" src="Photos/Icon/Categorias/categorias (8).png" alt="basura">
                <input type="text" value="1">
              </div>
              <div class="contenedorBasuraGota">
                <button class="gota">
                  <img class="gotaImg" src="Photos/Iconos_aplicacion/Blancos/Negativo/gota.png" alt="Color">
                </button>
                <button class="gota">
                  <img class="gotaImg" src="Photos/Iconos_aplicacion/Blancos/Negativo/basura.png" alt="Usuario">
                </button>
              </div>
            </div>
          </div>








        </div>






        <div class="laberDiv">
          <label for="">Configura la subcategoría</label>
          <div id="subcategoria" class="usuarioCategoriaSubcategoria">


            <div id="S_5" class="contendorCategoria">
              <div class="contenedorIconoText" style="background-color: #f5c7c7">
                <img class="icono" src="Photos/Icon/Subcategorias/GF (14).png" alt="basura">
                <div class="contenedorTexto">
                  <input type="text" value="2.comida">
                </div>
              </div>
              <div class="contenedorBasuraGota">
                <button class="gota basuraAdaptacion">
                  <img class="gotaImg " src="Photos/Iconos_aplicacion/Blancos/Negativo/basura.png" alt="Usuario">
                </button>
              </div>


              <form class="contendorCategoria">
                <div class="contenedorIconoText" style="background-color: #e4e4e4">
                  <img class="icono" src="Photos/Iconos_aplicacion/XX.png" alt="formulario">
                  <div class="contenedorTexto">
                    <input type="text" name="subcategoria" value="">
                    <input class="imputInvisible" type="text" name="imagen" value="">
                  </div>
                </div>
                <div class="contenedorBasuraGota imputMas">
                  <input type="submit" value="+" class="imputMasText">
                </div>
              </form>











            </div>





          </div>

        </div>
      </div>




      <div id="configuracionContenedor">
        <div id="gurpoA" class="gurpo">
          <div id="VacioInvisible" class="laberDiv positionAbsoluteA">
            <label for="">No ha selecionada nada</label>
            <div class="contenedorGeneralConfiguracion">
            </div>
          </div>

          <div id="ColorInvisible" class="laberDiv positionAbsoluteA">
            <label for="">Cambio de color</label>
            <div class="contenedorGeneralConfiguracion">
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
              <div class="div-pastel"></div>
            </div>
          </div>

          <div id="AvatarInvisible" class="laberDiv positionAbsoluteA">
            <label for="">Cambia la imagen al avatar</label>
            <div id="imgAvatar" class="contenedorGeneralConfiguracion">
            </div>
          </div>

          <div id="CategoriaInvisible" class="laberDiv positionAbsoluteA">
            <label for="">Cambia la imagen a la categoria</label>
            <div id="imgCagetoría" class="contenedorGeneralConfiguracion">
              <div id="wrapModificar"></div>
            </div>
          </div>

          <div id="SubcategoriaInvisible" class="laberDiv positionAbsoluteA">
            <label for="">Cambiala la imagen a la subcagetoría</label>
            <div id="imgSubcagetoría" class="contenedorGeneralConfiguracion">
            </div>
          </div>

          <div id="masImagen_relative">
            <div id="masImagen">
              <form action="../GestionImagenes" id="formImg" method="POST" enctype="multipart/form-data">
                <label for="file" class="imageM">
                  <input type="file" id="file" name="photo" accept="image/*">
                  +
                  <input type="text" id="tipoImagen" name="ima">
                  <input type="text" id="imgform" name="imgform">
                </label>
              </form>
              <button id="basura" class="imageM"><img
                  src="Photos/Iconos_aplicacion/Blancos/Nav_little/Basuras.png"></button>
            </div>
          </div>

        </div>

        <div id="gurpoB" class="gurpo">

          <div id="bottonGurpo_relative">
            <button id="bottonGurpoB" class="imageM">Tarjeta</button>
          </div>

          <div id="RestriccionesContenedor" class="positionAbsoluteB">
            <div class="laberDiv">
              <label for="">Restricciones</label>
              <div id="contenedorR">
                <div id="tabla">
                  <table>
                    <tr>
                      <th> Eliminar </th>
                      <th>Concepto</th>
                      <th>Categoría</th>
                      <th>Subcategoría</th>
                    </tr>
                    <tr>
                      <td><img class="gotaImg" src="Photos/Iconos_aplicacion/Blancos/Negativo/basura.png" alt="Usuario">
                      </td>
                      <td>Concepto A</td>
                      <td>Categoría A</td>
                      <td>Subcategoría A1</td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div id="TarjetaContenedor" class="positionAbsoluteB">
            <div class="laberDiv">
              <label for="">Tarjetas</label>
              <div id="contenedorR">
                <div id="tabla_tarjeta">
                  <table>
                    <tr>
                      <th>Eliminar </th>
                      <th>Nombre</th>
                      <th>Vencimiento</th>
                      <th>Limite</th>
                      <th>Descripción</th>
                    </tr>
                    <tr>
                      <td><img class="gotaImg" src="Photos/Iconos_aplicacion/Blancos/Negativo/basura.png" alt="Usuario">
                      </td>
                      <td><input type="text" name="categoria" value="" /></td>
                      <td><input type="date" name="subcategoria" value="" /></td>
                      <td><input type="number" name="vencimiento" value="" /></td>
                      <td><input type="text" name="descripcion" value="" /></td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

  </main>

  <footer>
    <p>&copy; 2023 Poryecto final de primero de programación de aplicaciones web.</p>
  </footer>
  <script src="JS/body_header_right.js"></script>
  <script src="JS/Body_warning.js"></script>
  <script src="JS/body_window_onload.js"></script>

  <script>
    
    // Tipo de imagen
    const basura = document.getElementById('basura');
    var formImg = document.getElementById('formImg');
    const fileInput = document.getElementById('file');
    // Boton imagen usuario 
    var usuarioImg = document.getElementById("usuarioImg");
    // Variables del grupo A
    var VacioInvisible = document.getElementById("VacioInvisible");
    var ColorInvisible = document.getElementById("ColorInvisible");
    var SubcategoriaInvisible = document.getElementById("SubcategoriaInvisible");
    var CategoriaInvisible = document.getElementById("CategoriaInvisible");
    var AvatarInvisible = document.getElementById("AvatarInvisible");
    var masImagen = document.getElementById("masImagen");
    // variables del grupo B
    var bottonGurpoB = document.getElementById("bottonGurpoB");
    var RestriccionesContenedor = document.getElementById("RestriccionesContenedor");
    var TarjetaContenedor = document.getElementById("TarjetaContenedor");

    // Variables Json
    var sub = "";
    var cat = "";
    var color;

    //Variables from
    var formSub;

    // Variables para que funcione la selección 
    var pintarColores;
    var imagenesSeleccionar;
    var marcarCatSub;
    var marcarCatSubTex;
    var BotonImagenCatSub;
    var icono;
    var gotaB;
    var validar;

    //variables
    var numeroTexto;
    var numero;
    var valorAlmacenado;
    var primerElementoColor;
    var formulario


// ╔══════════════════════════════════════════╗
// ║               Fetch inicial              ║
// ╚══════════════════════════════════════════╝
   
    // He necesitado crear esta función para solventar un error al cambiar de color y volver a pintar los elementos. 
    function actualizarJsonCatSub(res) {
      cat = JSON.parse(res.cat);
      sub = JSON.parse(res.sub);
      inicializar();
    }

    // Solo pinta las subcategorías
    function pintarSoloSub(res) {
      cat = JSON.parse(res.cat);
      sub = JSON.parse(res.sub);
      inicializar();
      // Las subcategoría depende de la categoría en una clave foranea. 
      // Para pintarlo necesito saber cual es la calve del la categoría y su color. 
      var caolor;
      var id = sessionStorage.getItem('id_cat');
      id = parseInt(id.replace(/\s/g, ''), 10);
      for (var i = 0; i < cat.length; i++) {
        if (cat[i].id === id) {
          color = cat[i].color;
        }
      }
      local = "subcategoria";
      pintarSub(sub, color, local, id);
    }

    // Cuando se modifican las categorías es necesario volver a pintarlas. 
    // Esto pinta categorías y subcategorías. 
    function pintarSoloSubCat(res) {
      cat = JSON.parse(res.cat);
      sub = JSON.parse(res.sub);
      inicializar();
      local = "categoria";
      pintarCat(cat, local)

      // Las subcategoría depende de la categoría en una clave foranea. 
      // Para pintarlo necesito saber cual es la calve del la categoría y su color. 
      var caolor;
      var id = sessionStorage.getItem('id_cat');
      id = parseInt(id.replace(/\s/g, ''), 10);
      for (var i = 0; i < cat.length; i++) {
        if (cat[i].id === id) {
          color = cat[i].color;
        }
      }
      local = "subcategoria";
      pintarSub(sub, color, local, id);
    }

    // Funcion para pintar toda la pagina.
    function pinterTodo(res) {
    // Las variables
    const imgLogin = JSON.parse(res.imgLogin);
    const imgCat = JSON.parse(res.imgCat);
    const imgSub = JSON.parse(res.imgSub);
    const rest = JSON.parse(res.res);
    const tar = JSON.parse(res.tar);
    let local, primerElementoColor, color, numeroTexto, numero, valorAlmacenado;

    // Parseamos y asignamos los valores a las variables globales cat y sub
    // Las pongo en variables fuera de la función porque se usaran para comparar 
    // variables con su contenido.
    cat = JSON.parse(res.cat);
    sub = JSON.parse(res.sub);

    // Pintamos las imagenes del usuario
    local = "imgAvatar";
    pintar(imgLogin, local);

    // Pintamos las imagenes de categorías
    local = "wrapModificar";
    pintar(imgCat, local);

    // Pintamos las imagenes de subcategorías
    local = "imgSubcagetoría";
    pintar(imgSub, local);

    // Pintamos los valores de la subcategoría
    // Las subcategoría depende de la categoría en una clave foranea. 
    // Para pintarlo necesito saber cual es la calve del la categoría y su color. 
    // Como es la primera vez que se pinta. Los valores iniciales hacen referencia al primer elemento de categorías
    primerElementoColor = cat[0];
    color = primerElementoColor.color;
    numeroTexto = sessionStorage.getItem('id_cat');
    numero = parseInt(numeroTexto, 10);
    valorAlmacenado = numero;    
    local = "subcategoria";
    pintarSub(sub, color, local, valorAlmacenado);

    // Pintamos los valores de la categoría
    local = "categoria";
    pintarCat(cat, local)

    // Pintamos restricciones
    local = "tabla";
    pintarRes(rest, local)

    // Pintamos tarjeta
    local = "tabla_tarjeta";
    pintarTar(tar, local)

    // Llamamos a las funciones para iniciarlas
    inicializar();
    selecionarColores(pintarColores);
    selecionarImagen();
    marcarCategorias();
    botonImagen();
    botonGota();
    ValidarInput();
    imprimir();
    botonBasura();
    ValidarForm();
}
    
    // ---------------------------------------------------------------------------------------

    // He considerado que una forma de optimizar sería que cuando tuviese que volver a pintar una página, 
    // se pinte solo la sección necesaria en lugar de renderizar toda la página nuevamente. 
    // Por ello, se utiliza una estructura switch para lograr esta optimización.
    function llamar(url, key) {
      fetch(url)
        .then(res => res.json())
        .then(res => {
          switch (key) {
            case 0:
              // Solo actualiza los json de cat y sub
              actualizarJsonCatSub(res);
              break;
            case 1:
              // Pinta subcategorías
              pintarSoloSub(res);
              break;
            case 2:
              // Pinta categorías
              pintarSoloSubCat(res);
              break;
            case 4:
              // Pinta todo
              pinterTodo(res);
              break;
            default:
              console.log("Opción inválida");
              break;
          }
        })
        .catch(error => {
          console.log(error);
        });
    }

    // Funcion que se lanza al cargar la pagina. 
    window.onload = function () {
      // Al cargar la pagina necesitamos ocultar algunos divs
      TarjetaContenedor.style.display = "none";
      TarjetaContenedor.style.pointerEvents = "none";
      masImagen.style.opacity = 0;
      masImagen.style.pointerEvents = "none";
      VacioInvisible.style.display = "block";
      VacioInvisible.style.pointerEvents = "auto";
      sessionStorage.setItem('id_cat', "1");
      // El valor 4 pinta toda la pagina.
      var Key = 4;
      llamar("../GestionConfiguracion", Key);
    }
   


// ╔══════════════════════════════════════════╗
// ║           Reiniciar funciones            ║
// ╚══════════════════════════════════════════╝

    // Cuando se repintan las categorías y subcategorías se debe de reiniciar ciertas funciones
    function inicializarFunciones() {
      marcarCategorias();
      botonImagen();
      botonBasura();      
      botonGota()
    
    }
    // Esta función se emplea cuando es necesario actualizar las variables con los nuevos datos una ver repintado zonas de la web 
    function inicializar() {
      validar = document.querySelectorAll('.validadInput');
      marcarCatSub = document.querySelectorAll('.contendorCategoria');
      marcarCatSubTex = document.querySelectorAll('.contenedorTexto');
      BasuraCat = document.querySelectorAll('.botonBasura');
      gotaB = document.querySelectorAll('.botonGota');
      BotonImagenCatSub = document.querySelectorAll('.icono');
      imagenesSeleccionar = document.querySelectorAll('.contenedorImagen');
      pintarColores = document.querySelectorAll('.div-pastel');
      iconoCoger = document.querySelectorAll('.icono');
    }



// ╔══════════════════════════════════════════╗
// ║            Pintar la web                 ║
// ╚══════════════════════════════════════════╝

    // Pintar Categorías      pinta las categorías. A esta función se le llamará en varias ocasiones
    function pintarCat(datos, contenedor) {
      let htm = "";
      for (let i = 0; i < datos.length; i++) {
        htm += `<div id="C_${datos[i].id}" class="contendorCategoria">
              <div class="contenedorIconoText" style="background-color: ${datos[i].color}">
                <img class="icono" src="${datos[i].imgString}" alt="basura">
                <div class="contenedorTexto">
                    <input class="validadInput" type="text" value="${datos[i].nombre}">
                </div>
              </div>
              <div class="contenedorBasuraGota">
                <button class="gota">
                  <img class="gotaImg botonGota" src="Photos/Iconos_aplicacion/Blancos/Negativo/gota.png" alt="Color">
                </button>
                <button class="gota">
                  <img class="gotaImg botonBasura" src="Photos/Iconos_aplicacion/Blancos/Negativo/basura.png" alt="Usuario">
                </button>
              </div>
            </div>`;
      }
      // Crea el formulario para añadir un elemento
      htm += `<form id="P"  class="contendorCategoria validadInput" action="../GestionConfiguracion" method="POST">
                <div id="cambiarColorForm" class="contenedorIconoText" style="background-color: #e4e4e4">
                    <img class="icono" src="Photos/Iconos_aplicacion/XX - copia.png" alt="formulario">
                    <div class="contenedorTexto">
                        <input id ="nombreCat" class="validadInput" type="text" name="subcategoria" value="">
                        <input id ="imputCAtImg" class="imputInvisible" type="text" name="imagenSub" value="">
                        <input id ="impIDCat" class="imputInvisible" type="text" name="IDCat" value="">
                        
                    </div>
                </div>
                <div class="contenedorBasuraGota adpatacionGota">
                <button class="gota">
                  <img class="gotaImg botonGota" src="Photos/Iconos_aplicacion/Blancos/Negativo/gota.png" alt="Color">
                </button>
              </div>
                <div class="ContenedorSubmit">

                  <input id="submitFromCat" type="submit" value="+" class="imputMasText">                                     
                </div>
            </form>`;
      document.getElementById(contenedor).innerHTML = htm;
      // Al llamar esta función, cambiar sus elementos y por tanto se deben de actualizar las funciones y los valores. 
      inicializar();
      inicializarFunciones();
    }

    // Pintar Subcategorías   pinta las subcategorías. A esta función se le llamará en varias ocasiones
    function pintarSub(datos, color, contenedor, id) {
      let htm = "";
      for (let i = 0; i < datos.length; i++) {
        if (datos[i].idCategoria === id) {
          htm += `<div id="S_${datos[i].id}" class="contendorCategoria">
              <div class="contenedorIconoText" style="background-color: ${color}">
                <img id="iconoIdImg" class="icono" src="${datos[i].img}" alt="basura">
                <div class="contenedorTexto">
                    <input class="validadInput" type="text" value="${datos[i].nombre}">
                </div>
              </div>
              <div class="contenedorBasuraGota">
                <button class="gota basuraAdaptacion">
                  <img class="gotaImg botonBasura" src="Photos/Iconos_aplicacion/Blancos/Negativo/basura.png" alt="Usuario">
                </button>
              </div>
            </div>`;
        }
      }
      // Crea el formulario para añadir un elemento
      htm += `<form id="X" class="contendorCategoria validadInput" action="../GestionConfiguracion" method="POST">
                <div class="contenedorIconoText" style="background-color: ${color}">
                    <img class="icono" src="Photos/Iconos_aplicacion/XX.png" alt="formulario">
                    <div class="contenedorTexto">
                        <input id ="nombreSub" class="validadInput" type="text" name="subcategoria" value="">
                        <input id ="imputSubImg" class="imputInvisible" type="text" name="imagenSub" value="">
                        <input id ="impID" class="imputInvisible" type="text" name="IDCat" value="1">
                        
                    </div>
                </div>
                <div class="contenedorBasuraGota imputMas  ">
                  <input id="submitFromSub" type="submit" value="+" class="imputMasText">                                     
                </div>
            </form>`;

      document.getElementById(contenedor).innerHTML = htm;
      // Al llamar esta función, cambiar sus elementos y por tanto se deben de actualizar las funciones y los valores. 
      inicializar();
      inicializarFunciones();
      ValidarForm();
    }

    // Pintar Restricciones   pinta los resultados de las restricciones
    function pintarRes(datos, contenedor) {
      let htm = `<table>
                      <tr>
                          <th>Eliminar</th>
                          <th>Concepto</th>
                          <th>Categoría</th>
                          <th>Subcategoría</th>
                       </tr>`;
      for (let i = 0; i < datos.length; i++) {
        htm += `<tr id="R_${datos[i].id}">
                    <td><img class="gotaImg" src="Photos/Iconos_aplicacion/Blancos/Negativo/basura.png" alt="Usuario">
                    </td>
                    <td>${datos[i].concepto}</td>
                    <td>${datos[i].categoria}</td>
                    <td>${datos[i].subcategoria}</td>
                  </tr>`;
      }
      htm += `</table>`;
      document.getElementById(contenedor).innerHTML = htm;
    }

    // Pintar Tarjeta:        pinta los resultados de la base de datos de tarjeta.
    function pintarTar(datos, contenedor) {
      let htm = `<table>
                      <tr>
                          <th>Eliminar </th>
                          <th>Nombre</th>
                          <th>Vencimiento</th>
                          <th>Limite</th>
                          <th>Descripción</th>
                       </tr>`;
      for (let i = 0; i < datos.length; i++) {
        htm += `<tr id="T_${datos[i].id}">
                    <td><img class="gotaImg" src="Photos/Iconos_aplicacion/Blancos/Negativo/basura.png" alt="Usuario"></td>
                    <td><input type="text" name="Tarjeta_nombre" value="${datos[i].nombre}"></td>
                    <td><input type="date" name="Tarjeta_vencimiento" value="${datos[i].vencimiento}"></td>
                    <td><input type="number" name="Tarjeta_limite" value="${datos[i].limite}"></td>
                    <td><input type="text" name="Tarjeta_descripcion" value="${datos[i].descripcion}"></td>                  
              </tr>`;
      }
      htm += `</table>`;
      document.getElementById(contenedor).innerHTML = htm;
    }

    // Pintar imágenes:       pinta todas las imágenes de los divs que servirán para cambiar los iconos   
    function pintar(datos, contenedor) {
      let htm = "";
      for (i = 0; i < datos.length; i++) {
        htm += "<div id=L_'" + datos[i].id + "' class='contenedorImagen'><img src='" + datos[i].img + "'></div>";
      }
      document.getElementById(contenedor).innerHTML = htm;
    }



// ╔════════════════════════════════════════════════════════════════╗
// ║    Funciones para dejar marcado las eleciones del usuario      ║
// ╚════════════════════════════════════════════════════════════════╝

    // Marca los colores     y actualiza la base de datos con la nueva elección. 
    function selecionarColores(dato) {
      // Agrupacion de variables      
      const divs = dato;      
      var cambiarColorForm, impIDCat, padre, hijo, cat, nombre, id_imagen, catID;

      // Para cada div en nuestra lista de divs
      divs.forEach((div) => {
        // Añadimos un listener de eventos de click
        div.addEventListener('click', function () {
          // 1º Parte dejar selecionado la eleción del usuario. 
          // Por cada click, eliminamos la sombra de todos los divs
          divs.forEach((otherDiv) => {
            otherDiv.style.boxShadow = 'none';
          });
          // Luego, añadimos sombra al div que ha sido clickeado
          div.style.boxShadow = 'inset 0 0 0 4px red';

          // 2º Parte  
          // Obtenemos el color del div que ha sido clickeado
          const backgroundColor = getComputedStyle(div).backgroundColor;
          // Convertimos el color a formato hexadecimal con una función. 
          const hexColor = rgbConvert(backgroundColor);

          // Obtenemos un item del sessionStorage
          let divCat = sessionStorage.getItem('id');

          // Actualizamos el valor del campo "impIDCat" con el color hexadecimal
          impIDCat = document.getElementById("impIDCat");
          impIDCat.value = hexColor;

          // Si el item no está vacío, obtenemos el div padre y el primer div hijo
          // Esto es porque no se estaba apuntando correctamente al div. 
          padre = document.getElementById(divCat);
          hijo = padre.querySelector('div');
          // Cambiamos el color de fondo del div hijo
          hijo.style.backgroundColor = hexColor;

          // Si estamos en el formulario para crear no envia el update. 
          // Solo tiene la función de cambiar de color la categoría. 
          if (!Condicional_idP()) {
            // Obtenemos más datos del sessionStorage
            cat = sessionStorage.getItem('id');
            nombre = "";
            id_imagen = 0;
            catID = sessionStorage.getItem('id_cat');

            // Actualizamos el grupo con los datos obtenidos
            UpdateGrupoA(cat, id_imagen, nombre, hexColor, catID);

            // Pintamos de nuevo la categoría y subcategoría
            var Key = 0;
            llamar("../GestionConfiguracion", Key);
            Key = 1;
            llamar("../GestionConfiguracion", Key);
          }
        });
      });
    }

    // selecionarImagen: maneja el evento de hacer clic en las imágenes de configuración, y envía las modificaciones cuando sea necesario.
    // Valida si la imagen seleccionada esta ya elegida en otro apartado. 
    function selecionarImagen() {
      // Definimos las variables que utilizaremos en la función.
      const divs = imagenesSeleccionar;
      let sesion, id_imagen, imagen, src, comparacion, formSub2, formSub, id;
      const iconoCogerArray = Array.from(iconoCoger);

      // Para cada div en la colección "divs". 
      divs.forEach(function (div) {
        // Agregamos un manejador de eventos para el evento "click" en cada div
        div.addEventListener('click', function () {
          // 1º Parte
          // Para cada div, hacemos que su fondo sea transparente
          divs.forEach(function (otherDiv) {
            otherDiv.style.backgroundColor = 'transparent';
          });
          // Cambiamos el fondo del div que fue clickeado a rojo
          div.style.backgroundColor = 'red';
          
          // 2º Parte  ----------------------------------------------------------
          // Obtenemos el id de la imagen y el atributo src de la imagen
          id_imagen = div.id;
          imagen = div.querySelector('img');
          src = imagen.getAttribute('src');

          // Almacenamos el src en sessionStorage y obtenemos el valor actual almacenado bajo 'dir2'
          sessionStorage.setItem('dir', src);
          comparacion = sessionStorage.getItem('dir2');

          // Obtenemos el valor actual del input cuyo nombre es "imagenSub"
          formSub2 = document.querySelectorAll('input[name="imagenSub"]');
          formSub = formSub2.value;
          console.log(formSub);

          // Verificamos si el src de la imagen se encuentra en el array iconoCogerArray
          // Si es asi, el update no se puede llevar a cabo y se detendrá. 
          if (iconoCogerArray.some(icono => icono.getAttribute('src') === src)) {
            div.style.backgroundColor = 'green';
            return;
          } else {
            // Si no se encuentra en iconoCogerArray, obtenemos el id almacenado en sessionStorage            
            id = sessionStorage.getItem('id');
            // Si el usuario  esta en alguno de los formularios para crear nuevos registros, entrará en la condición.
            if (Condicional_idP() || Condicional_idX()) {
              formSub2.forEach(function (element) {
                element.setAttribute('value', id_imagen);
              });
            }
            // Para cada icono en la colección "iconoCoger", comparamos su src con el valor de comparacion.
            // Si no lo esta, modificamos de parte del cliente el incono. 
            iconoCoger.forEach(function (icono) {
              const src2 = icono.getAttribute('src');
              if (src2 === comparacion) {
                sessionStorage.setItem('dir2', src);
                icono.setAttribute('src', src);
                // Si el usuario no esta en alguno de los formularios para crear nuevos registros, entrará en la condición.
                if (!Condicional_idP() && !Condicional_idX() ) {
                  let cat = sessionStorage.getItem('id');
                  let nombre = "";
                  let color = "";
                  let catID = sessionStorage.getItem('id_cat');
                  UpdateGrupoA(cat, id_imagen, nombre, color, catID);
                }
              } else {
                console.log("No ha entrado");
              }
            });
          }
        });
      });
    };


    function marcarImagenCategorias() {


      const divs = marcarCatSub;

      divs.forEach(function (div) {
        div.addEventListener('click', function () {

          divs.forEach(function (otherDiv) {
            otherDiv.style.boxShadow = 'none'; // Eliminar la sombra en los otros divs
            otherDiv.style.opacity = '0.4';
          });
          div.style.boxShadow = "0 0 10px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 0, 0, 0.3), 0 0 30px rgba(0, 0, 0, 0.2), 0 0 40px rgba(0, 0, 0, 0.1)";
          div.style.opacity = '1';

          const contenedor = event.target.closest('.contendorCategoria');
          if (contenedor) {
            var id = contenedor.id;
            primeraLetra = id.charAt(0);
            console.log(primeraLetra);
          }
          console.log(id);
          sessionStorage.setItem('id', id)



          var restoTexto = id.substring(2);
          var resto = parseInt(restoTexto, 10);
          var numeroTexto = sessionStorage.getItem('id_cat')
          var valorAlmacenado = parseInt(numeroTexto, 10);


          if (primeraLetra === "C") {
            var impID = document.getElementById("impID");

            impID.setAttribute('value', restoTexto);

            if (resto != valorAlmacenado) {
              sessionStorage.setItem('id_cat', resto);
              sessionStorage.setItem('id_cat2', id);
              for (var i = 0; i < cat.length; i++) {
                if (cat[i].id === resto) {
                  color = cat[i].color;
                  break;
                }
              }


              local = "subcategoria";
              pintarSub(sub, color, local, resto);


            }
          }


        });
      });
    }



    // Marcar las categorias
    function marcarCategorias() {
      // Agrupando las variables al comienzo
      const divs = marcarCatSubTex;
      let padres, id, primeraLetra, restoTexto, resto, numeroTexto, valorAlmacenado;
      let impIDCat3, impIDCat4, local, color;

      // Bucle que recorre todos los divs
      divs.forEach((div) => {
        // Asignando un eventListener a cada div
        div.addEventListener('click', function (event) {
          // Necesito modificar el div que esta por encima del div al que apunto.
          padres = this.parentElement.parentElement;

          // Bucle que recorre de nuevo todos los  divs
          divs.forEach((otherDiv) => {
            // Si el elemento div es diferente al seleccionado se le modifica el estilo de los demas divs
            const otherPadres = otherDiv.parentElement.parentElement;
            if (otherPadres !== padres) {
              otherPadres.style.boxShadow = 'none';
              otherPadres.style.opacity = '0.4';
            }
          });

          // Modifico el estilo del elemento seleccionado
          padres.style.boxShadow = "0 0 10px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 0, 0, 0.3), 0 0 30px rgba(0, 0, 0, 0.2), 0 0 40px rgba(0, 0, 0, 0.1)";
          padres.style.opacity = '1';

          // Buscando el contenedor más cercano con clase '.contendorCategoria'
          const contenedor = event.target.closest('.contendorCategoria');
          if (contenedor) {
            id = contenedor.id;
            primeraLetra = id.charAt(0);
            console.log("marcarCategorias    " + primeraLetra);
          }


          restoTexto = id.substring(2);
          resto = parseInt(restoTexto, 10);
          numeroTexto = sessionStorage.getItem('id_cat')
          valorAlmacenado = parseInt(numeroTexto, 10);



          // Si la condición es verdadera, se limpia el contenido del elemento con id 'subcategoria'
          if (id === "P") {
            local = "subcategoria";
            document.getElementById(local).innerHTML = "";
          }

          // Si la primera letra del id es 'C'
          if (primeraLetra === "C") {
            if (resto != valorAlmacenado) {
              sessionStorage.setItem('id_cat', resto);
              sessionStorage.setItem('id_cat2', id);
              // Buscando el color correspondiente
              for (let i = 0; i < cat.length; i++) {
                if (cat[i].id === resto) {
                  color = cat[i].color;
                  break;
                }
              }

              local = "subcategoria";
              pintarSub(sub, color, local, resto);

              // Ocultando todos los elementos y mostrando sólo los necesarios
              ocultarTodo();

              VacioInvisible.style.display = "block";
              VacioInvisible.style.pointerEvents = "auto";
              masImagen.style.opacity = 0;
              masImagen.style.pointerEvents = "none";
            }
            // Si la primera letra del id no es 'C'
          } else if (resto != valorAlmacenado) {
            // Ocultar todos los elementos
            ocultarTodo();

            // Permitir la interacción con masImagen y cambiar su opacidad a 1
            masImagen.style.opacity = 1;
            masImagen.style.pointerEvents = "auto";

          } else {
            // En caso de que las categorías sean iguales, se envía un mensaje de consola
            console.log("Las categorías son iguales");
          }
        });
      });
    }







    // botonImagen: Reacciona con todas las imagenes de los div que tienen como titulo "cambia la imagen..."
    //  Maneaj la interacción del usuario con el conjunto de imágenes de cada div, marcando la imagen seleccionada 
    // y si se cumplen ciertos parametros, actualizar la imagen de la base de datos. 
    function botonImagen() {
      // Agrupamos todas las variables al comienzo de la función
      const divs = BotonImagenCatSub;
      let contenedor, src, imagen, ImagenesDinamicas, id, primeraLetra, imagen2, src2, comparacion;
      // Buscamos los elementos del DOM por su id
      let tipoImagen = document.getElementById('tipoImagen');
      let masImagen = document.getElementById('masImagen');
      let SubcategoriaInvisible = document.getElementById('SubcategoriaInvisible');
      let CategoriaInvisible = document.getElementById('CategoriaInvisible');

      // Llamamos a la función para marcar las imágenes de las categorías
      marcarImagenCategorias();

      // Para cada div en nuestra lista de divs
      divs.forEach((div) => {
        // Añadimos un listener de eventos de click
        div.addEventListener('click', (event) => {
          // Buscamos el contenedor más cercano a nuestro elemento clickeado con la clase '.contendorCategoria'
          contenedor = event.target.closest('.contendorCategoria');

          // Si encontramos dicho contenedor
          if (contenedor) {
            // Obtenemos la imagen dentro de este contenedor y el src
            imagen = contenedor.querySelector('img');
            src = imagen.getAttribute('src');

            // Guardamos este atributo 'src' en el sessionStorage que nos servira para realizar comparaciones y cambiar la imagen
            sessionStorage.setItem('dir', src);
            sessionStorage.setItem('dir2', src);

            // Buscamos todos los elementos con la clase '.contenedorImagen' y para cada uno de estos elementos...
            ImagenesDinamicas = document.querySelectorAll('.contenedorImagen');
            ImagenesDinamicas.forEach((div) => {
              // Obtenemos la imagen dentro de este div el src e inicializamos la variables comparacion
              imagen2 = div.querySelector('img');
              src2 = imagen2.getAttribute('src');
              comparacion = sessionStorage.getItem('dir');

              // Estas lineas de codigo sirven para dejar marcadas la selección de la imagen 
              if (src2 === comparacion) {
                ImagenesDinamicas.forEach((otherDiv) => {
                  otherDiv.style.backgroundColor = 'transparent';
                });
                div.style.backgroundColor = 'red';
              }
            });

            // Si se cumple la condición que la "sessionStorage id" y "sessionStorage id_cat" es igual a C.

            id = contenedor.id;
            primeraLetra = id.charAt(0);
            // Unas series de condicionales dependientes de  primeraLetra
            if (primeraLetra === "S" || Condicional_idX()) {
              // Cambiamos el valor de 'tipoImagen' a 'subcategoria'
              tipoImagen.value = "subcategoria";
              // Llamamos a la función para ocultar todos los div y cambiar sus eventos de puntero a nule
              ocultarTodo();
              // Cambiamos la opacidad y los eventos de puntero de 'masImagen' y 'SubcategoriaInvisible'
              masImagen.style.opacity = 1;
              masImagen.style.pointerEvents = "auto";
              SubcategoriaInvisible.style.display = "block";
              SubcategoriaInvisible.style.pointerEvents = "auto";
            }

            else if (primeraLetra === "C" || Condicional_idP()) {
              tipoImagen.value = "categoria";
              ocultarTodo();
              masImagen.style.opacity = 1;
              masImagen.style.pointerEvents = "auto";
              CategoriaInvisible.style.display = "block";
              CategoriaInvisible.style.pointerEvents = "auto";
            }
          }
        });
      });
    };




    function botonBasura() {
      const divs = BasuraCat;

      divs.forEach((div) => {
        div.addEventListener('click', (event) => {

          var cat = sessionStorage.getItem('id');
          var img = 0;
          var nombre = "";
          var color = "";
          var idCatSinLetra = 0;

          UpdateGrupoA(cat, img, nombre, color, idCatSinLetra);
          console.log("eliminandooooooooooooooooooo     " + cat)
          var Key = 0;
          llamar("../GestionConfiguracion", Key);
          Key = 2;
          llamar("../GestionConfiguracion", Key);
        });
      });
    }

    // Boton gota
    function botonGota() {

      const divs = gotaB;

      divs.forEach((div) => {
        div.addEventListener('click', (event) => {
          // Hacer visibles los elementos y desactivar los demás
          VacioInvisible.style.display = "none";
          VacioInvisible.style.pointerEvents = "none";
          masImagen.style.opacity = 1;
          masImagen.style.pointerEvents = "auto";

          ColorInvisible.style.display = "block";
          ColorInvisible.style.pointerEvents = "auto";

          SubcategoriaInvisible.style.display = "none";
          SubcategoriaInvisible.style.pointerEvents = "none";
          CategoriaInvisible.style.display = "none";
          CategoriaInvisible.style.pointerEvents = "none";
          AvatarInvisible.style.display = "none";
          AvatarInvisible.style.pointerEvents = "none";

          //Funcion seleccionar el color
          const contenedor = event.target.closest('.contendorCategoria');
          var id = contenedor.id;



          var restoTexto = id.substring(2);
          var resto = parseInt(restoTexto, 10);
          let color;

          for (let i = 0; i < cat.length; i++) {
            if (cat[i].id === resto) {
              color = cat[i].color;
              break;
            }
          }

          var r = parseInt(color.slice(1, 3), 16);
          var g = parseInt(color.slice(3, 5), 16);
          var b = parseInt(color.slice(5, 7), 16);

          // Crea el color en formato RGB
          color = `rgb(${r}, ${g}, ${b})`;

          var divPasteles = document.querySelectorAll('.div-pastel');

          // Recorrer cada elemento y obtener el color de fondo
          divPasteles.forEach((div) => {
            var backgroundColor = getComputedStyle(div).backgroundColor;
            if (backgroundColor === color) {
              divPasteles.forEach((otherDiv) => {
                otherDiv.style.boxShadow = 'none';
              });
              div.style.boxShadow = 'inset 0 0 0 4px red'; // Cambia el borde del div en caso de coincidencia
            }
          });
        });
      });
    }


    function ValidarForm() {
      const divs = validar;
      let salir = 0;
      let repeticion = 0;
      let valorInicial, valorActual, nombreSub, imputSubImg, impID, colorSub, catSub;
      let Key = 0;
      divs.forEach(function (input) {
        if (input.tagName === 'FORM') {

          input.addEventListener('submit', function (event) {
            
            event.preventDefault();

            colorSub = "";
            catSub = 0;

            if (Condicional_idP()) {
             
              nombreSub = document.getElementById('nombreCat').value;
              imputSubImg = document.getElementById('imputCAtImg').value;
              impID = document.getElementById('impIDCat').value;
              colorSub = impID;
              impID = "";
            } else if (Condicional_idX()) {
             
              console.log('zxxxxxxxxxxxxxxxxxxxxxzzzzzzzzzzzzzzzzzzzzzzzzzzzzzccccccccccccccssssssssssssffffff:');
              nombreSub = document.getElementById('nombreSub').value;
              imputSubImg = document.getElementById('imputSubImg').value;
              impID = document.getElementById('impID').value;
            } else {
            
              console.log("cosssssssssssssssssssss          :" + Condicional_idP());
              return;
            }

            var valor = imputSubImg.trim();
            var valor2 = nombreSub.trim();
            if ((valor === '' || valor2 === '') && (cat[i].nombre === nombreSub || sub[i].nombre === nombreSub)) {
             
              console.log('Campo "imagenSub" vacío');
              return;
            } else {
              console.log('Preparando el envio.....');
              UpdateGrupoA(catSub, imputSubImg, nombreSub, colorSub, impID);
              llamar("../GestionConfiguracion", Key);
              Key = 2;
              llamar("../GestionConfiguracion", Key);
            }
          });
        }
      });
    }





    function ValidarInput() {
      const divs = validar;
      let salir = 0;
      let repeticion = 0;
      let valorInicial, valorActual, nombreSub, imputSubImg, impID, colorSub, catSub;
      let Key = 0;

      // Recorremos cada elemento en divs
      divs.forEach(function (input) {

        input.addEventListener('click', function () {
          valorInicial = input.value;
        });


        // Independientemente de si el elemento es un formulario o no, agregamos un evento 'blur' a cada input
        input.addEventListener('blur', function () {
          console.log('fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff:');
          valorActual = input.value;
          if ((valorActual !== valorInicial && valorActual !== '') && (!Condicional_idP() && !Condicional_idX()) ) {
            for (var i = 0; i < cat.length; i++) {
              if (cat[i].nombre === valorActual || sub[i].nombre === valorActual) {
                input.value = valorInicial;
                console.log('El nombre coincide con el valor actual Categoria:', cat[i].nombre);
                return;
              } else {
                repeticion++;
                if (repeticion === 1) {
                  input.value = valorActual;
                  let cat = sessionStorage.getItem('id');
                  let img = 0;
                  let color = "";
                  let catID = sessionStorage.getItem('id_cat');                  
                  UpdateGrupoA(cat, img, valorActual, color, catID);
                  console.log('valor unico')
                }
              }
            }
          } else if (valorActual === '') {
            console.log('No ha cambiado ' + valorActual);
            input.value = valorInicial;
          }
        });
      });
    }









































    function UpdateGrupoA(cat, img, nombre, color, idCatSinLetra) {

      var formData = new FormData();
      formData.append('idCat', cat);
      formData.append('idImg', img);
      formData.append('idNombre', nombre);
      formData.append('idcolor', color);
      formData.append('idCatSinLetra', idCatSinLetra);

      console.log('Datos enviados:', formData);
      fetch('../UpdateCategorias', {
        method: 'POST',
        body: formData,
      }).then(response => {
        console.log('Conseguido');

      }).catch(error => {
        console.error('Error en la subida:', error);
      });

    };


















    // Boton para eliminar
    basura.addEventListener('click', function (event) {

      var imgform = document.getElementById('imgform');
      var imgf = imgform.value;
      if (imgf.trim() != '') {
        let scr = sessionStorage.getItem('dir');
        fetch('../EliminarImagenes', {
          method: 'POST',
          body: scr,
        }).then(response => {
          console.log('eliminado');
          // llamar("../gestionImagenUsuario");
        }).catch(error => {
          console.error('Error en la subida:', error);

        });


      }
    });

    // ¿Ha cambiado el input de la imagen?
    file.addEventListener('change', function (event) {
      const file = fileInput.files[0];
      if (file) {
        const formData = new FormData();
        formData.append('photo', file);
        // Puedes agregar más campos al objeto formData según tus necesidades
        const tipoImagen = document.getElementById('tipoImagen').value;
        formData.append('ima', tipoImagen);

        fetch('../GestionImagenes', {
          method: 'POST',
          body: formData
        }).then(response => {
          console.log('Subida completada');
          // llamar("../gestionImagenUsuario");
        }).catch(error => {
          console.error('Error en la subida:', error);
          // Aquí puedes manejar los errores de la solicitud
        });
      } else {
        console.log('No se seleccionó ningún archivo');
      }
    });

    // Cambiar imagen usuario
    usuarioImg.addEventListener("click", function () {

      const ImagenesDinamicas = document.querySelectorAll('.contenedorImagen');

      // Recorrer cada elemento y obtener el color de fondo
      ImagenesDinamicas.forEach((div) => {
        var imagen2 = div.querySelector('img');

        var src2 = imagen2.getAttribute('src');
        var comp = document.getElementById('usuarioImg')
        var comparacion = comp.getAttribute('src');
        if (src2 === comparacion) {
          ImagenesDinamicas.forEach((otherDiv) => {
            otherDiv.style.backgroundColor = 'transparent';
          });
          div.style.backgroundColor = 'red'; // Cambia el borde del div en caso de coincidencia
        }
      });



      tipoImagen.value = "login";
      VacioInvisible.style.display = "none";
      VacioInvisible.style.pointerEvents = "none";
      masImagen.style.opacity = 1;
      masImagen.style.pointerEvents = "auto";

      ColorInvisible.style.display = "none";
      ColorInvisible.style.pointerEvents = "none";

      SubcategoriaInvisible.style.display = "none";
      SubcategoriaInvisible.style.pointerEvents = "none";

      CategoriaInvisible.style.display = "none";
      CategoriaInvisible.style.pointerEvents = "none";

      AvatarInvisible.style.display = "block";
      AvatarInvisible.style.pointerEvents = "auto";
    });

    // Boton grupo B
    bottonGurpoB.addEventListener("click", function () {
      var texto = bottonGurpoB.innerText;
      if (texto === "Tarjeta") {
        bottonGurpoB.innerText = "Restricción";
        RestriccionesContenedor.style.display = "none";
        RestriccionesContenedor.style.pointerEvents = "none";
        TarjetaContenedor.style.display = "block";
        TarjetaContenedor.style.pointerEvents = "auto";
      } else {
        bottonGurpoB.innerText = "Tarjeta";
        RestriccionesContenedor.style.display = "block";
        RestriccionesContenedor.style.pointerEvents = "auto";
        TarjetaContenedor.style.display = "none";
        TarjetaContenedor.style.pointerEvents = "none";
      }

    });

    // funcion para convertir rgb a hexadecimal. 
    function rgbConvert(rgb) {
      let sep = rgb.indexOf(",") > -1 ? "," : " ";
      rgb = rgb.substr(4).split(")")[0].split(sep);

      let r = (+rgb[0]).toString(16),
        g = (+rgb[1]).toString(16),
        b = (+rgb[2]).toString(16);

      if (r.length == 1)
        r = "0" + r;
      if (g.length == 1)
        g = "0" + g;
      if (b.length == 1)
        b = "0" + b;

      return "#" + r + g + b;
    }



    function Condicional_idP() {

      var id = sessionStorage.getItem('id');
      if ((id === "P")) {
        return true;
      } else {
        return false;
      }
    }
    function Condicional_idX() {

      var id = sessionStorage.getItem('id');
      if ((id === "X")) {
        return true;
      } else {
        return false;
      }
    }







    function ocultarTodo() {
      VacioInvisible.style.display = "none";
      VacioInvisible.style.pointerEvents = "none";

      masImagen.style.opacity = 0;
      masImagen.style.pointerEvents = "none";

      ColorInvisible.style.display = "none";
      ColorInvisible.style.pointerEvents = "none";

      SubcategoriaInvisible.style.display = "none";
      SubcategoriaInvisible.style.pointerEvents = "none";

      CategoriaInvisible.style.display = "none";
      CategoriaInvisible.style.pointerEvents = "none";

      AvatarInvisible.style.display = "none";
      AvatarInvisible.style.pointerEvents = "none";
    }















  </script>

</body>

</html>